# 时间线纠错功能使用指南

## 功能概述

时间线纠错功能可以自动优化用户输入的口语化日记文本，纠正错别字、删除冗余词汇，并保持原有的情感色彩和个人口吻。

## 使用流程

### 1. 打开时间线叙事模式

在主界面点击"时间线叙事"进入时间线日记页面。

### 2. 输入内容

在底部输入框中输入你的日记内容，例如：
```
今天天气很好额，我去了那个公园，然后额看到了很多花。
```

### 3. 点击纠错按钮

点击输入框上方的紫色"纠错"按钮（图标：✨ auto_fix_high）。

### 4. 实时查看纠错过程

弹出对话框会实时显示AI的纠错过程：

- **删除线（灰色）**: 表示被删除或修改的内容
  - 例如："额"、"那个"会显示为 ~~额~~、~~那个~~

- **紫色文本**: 表示修改后的内容
  - 例如："今天天气很好额" → "今天天气很好额**今天天气很好**"

- **正常文本**: 表示未修改的内容

### 5. 确认结果

纠错完成后，会弹出确认对话框显示：

#### 显示内容
- 纠错后的完整文本（带删除线和紫色高亮）
- "AI 已完成指令" 提示
- 变更摘要（错别字修正、冗余表达删减）

#### 操作选项

**【接受】**
- 用纠错后的文本替换输入框内容
- 静默处理，无额外提示

**【取消】**
- 保留原始输入内容
- 静默处理，无额外提示

**【重试】**
- 重新调用AI进行纠错
- 可能获得不同的优化结果

## 纠错类型说明

### 纠正（紫色高亮）
修正错别字或语法错误，例如：
- "今天天气很好" → "今天天气很好"（无变化）
- "我去了公园玩耍" → "我去了公园游玩"（语义优化）

### 删除（删除线+灰色）
删除冗余词汇或填充词，例如：
- ~~额~~
- ~~那个~~
- ~~就是说~~
- ~~然后~~

### 不变
原文已经规范，无需修改。

## 视觉效果

### 深色主题
- 删除文本：灰色（Colors.grey.shade500）
- 修改文本：浅紫色（#CE93D8）
- 正常文本：白色（87%透明度）

### 浅色主题
- 删除文本：灰色（Colors.grey.shade600）
- 修改文本：浅紫色（#BA68C8）
- 正常文本：黑色（87%透明度）

## 注意事项

### ✅ 优点
1. 实时反馈，边处理边显示
2. 可重试，获得不同优化方案
3. 保留原意和情感，不改变叙事风格
4. 深浅色主题完美适配

### ⚠️ 限制
1. 需要网络连接AI服务
2. 处理速度取决于AI响应速度
3. 建议单次输入不超过500字

### ❌ 错误处理
- 网络中断：显示"纠错失败，请重试"
- AI返回格式错误：显示"解析纠错结果失败"
- 其他异常：显示具体错误信息

## 技术细节

### AI处理流程
1. 文本按句号、问号、感叹号等分割为片段
2. 逐片段分析并优化
3. 流式返回JSON格式结果
4. 客户端实时解析并渲染

### 数据格式
```json
{
  "seq": 1,
  "before": "原始文本片段",
  "after": "优化后的文本片段",
  "type": "纠正/删除/不变"
}
```

### 渲染策略
- `type='删除'`: 显示 `before`（删除线+灰色）
- `type='纠正'`: 显示 `before`（删除线）+ `after`（紫色）
- `type='不变'`: 显示 `after`（正常颜色）

## 常见问题

### Q1: 纠错后文字不符合我的风格怎么办？
A: 点击"重试"按钮重新生成，或者点击"取消"保留原文。

### Q2: 纠错过程中可以关闭对话框吗？
A: 可以点击左上角的关闭按钮，会终止纠错并保留原文。

### Q3: 为什么有些文字显示为灰色删除线？
A: 灰色删除线表示AI认为这是冗余词汇（如"额"、"那个"），建议删除。

### Q4: 紫色文字是什么意思？
A: 紫色文字表示AI修改后的内容，包括纠正错别字或优化表达。

### Q5: 深色主题下看不清文字？
A: 已优化，深色主题使用浅色文字，浅色主题使用深色文字，确保可见性。

### Q6: 点击"接受"后有弹窗提示吗？
A: 没有，为了更流畅的体验，接受和取消操作都不再弹出额外提示。

## 反馈与建议

如有问题或建议，请联系开发团队。
